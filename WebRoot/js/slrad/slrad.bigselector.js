SLRAD.prototype.setBigSelector=function(a){this.bigSelector=a};
function slradBigSelector(a){var b=new SLRAD;b.setBigSelector(this);a.data("slrad",b);this.element=a;this.id=a.attr("id");this.autoComplete=a.attr("autoComplete");this.dialog=a.attr("dialog");this.selectedModel=a.attr("selectedModel")||"sigle";this.separator=a.attr("separator")||",";if(this.separator.indexOf("\\")!=-1){try{window.eval("window._tmp_separator='"+this.separator+"'")}catch(c){if(SL.debugEnable)throw c;}this.separator=window._tmp_separator}if(this.autoComplete)a=$("#"+this.autoComplete),
this.autoCompleteProps=a={element:a,actionUrl:a.attr("actionUrl"),fieldName:a.attr("fieldName")||"keyword",datasource:a.attr("datasource"),datasourceArgs:a.attr("datasourceArgs"),options:a.attr("autoComepletOptions")||{},pageSize:a.attr("pageSize"),renderItemFunc:a.attr("renderItemFunc")},this.initAutoComplete();if(this.dialog)a=$("#"+this.dialog),this.dialogProps=a={element:a,button:a.attr("dialogButton"),dialogOn:a.attr("dialogOn")||"click",options:a.attr("dialogOptions")||{},cascadeTo:a.attr("cascadeTo"),
selectFrom:a.attr("selectFrom"),selectFields:(a.attr("selectFields")||"").split(",")},this.initDialog()}
slradBigSelector.prototype.initAutoComplete=function(){var a=this,b=a.autoCompleteProps;b.datasource&&b.datasourceArgs&&b.element.data("datasourceArgs",SL.parseJson(b.datasourceArgs));if(b.options)b.options=SL.parseJson(b.options);var c=b.options;if(a.selectedModel=="multiple")c.focus=function(){return!1};c.source=function(c,e){var d=c.term;a.selectedModel=="multiple"&&(d=d.split(a.separator).pop());var g={};if(b.datasourceArgs){var f=b.element.data("datasourceArgs");$.extend(g,f)}g[SL.KEYS.SERVICE]=
b.datasource;g[SL.KEYS.PAGE_SIZE]=b.pageSize;g[b.fieldName]=d;jQuery.ajaxSettings.traditional=!0;$.post(b.actionUrl,g,function(a){if(a.success)if(!a.dataFields||!a.dataList)SL.debugEnable&&SL.debug("\u65e0\u6570\u636e\uff0c\u8bf7\u68c0\u67e5datasource:"+element.attr("datasource"));else{b.element.data("resp",a);b.element.trigger("afterInitData",a);var d=[];$.each(a.dataList,function(a,b){d.push({label:b[0],value:b.length>1?b[1]:b[0],datas:b})});e(d)}else SL.error(a.message,a.props&&a.props.loginUrl)},
"json")};c.select=function(b,e){if(a.selectedModel=="sigle")return!0;else if(a.selectedModel=="multiple"){var d=a.element.val().split(a.separator);d.pop();var g=$.inArray(e.item.value,d);g!=-1&&d.splice(g,1);d.push(e.item.value);d.push("");a.element.val(d.join(a.separator));return!1}try{window.eval("window."+a.selectedModel)(a.elemenet,e.item.datas)}catch(f){if(SL.debugEnable)throw SL.debug("\u81ea\u5b9a\u4e49\u9009\u62e9\u51fd\u6570"+a.selectedModel+"\u6267\u884c\u5f02\u5e38:"+f),f;}return!1};a.element.autocomplete(c)};
slradBigSelector.prototype.initDialog=function(){var a=this,b=a.dialogProps;b.button=b.button?$("#"+b.button):a.element;b.selectFrom=b.selectFrom?$("#"+b.selectFrom):$(".DataGrid,.Tree",b.element);if(b.options)b.options=SL.parseJson(b.options);var c=function(){var e=b.selectFrom.data("slrad");if(e)if(e=e.dataGrid||e.tree){var e=e.getStateParams(),d=e.datas||e.keys;if(d){var g=e.props.pickedItemNum;if(!(g<1)){var f=[];b.selectFields.length<1?$.each(d,function(a,b){$.each(d[b],function(b,d){f[b]||(f[b]=
[]);f[b][a]=d})}):$.each(b.selectFields,function(a,b){var c=[];if(b in d)c=d[b];else{try{window.eval(b)}catch(e){if(SL.debugEnable)throw e;}for(var h=0;h<g;h++)c[h]=""}$.each(c,function(b,c){f[b]||(f[b]=[]);f[b][a]=c})});if(a.selectedModel=="sigle")a.element.val(f[0].join(""));else if(a.selectedModel=="multiple"){var c=$.trim(a.element.val()).split(a.separator);c[0]==""&&c.shift();$.each(f,function(a,b){var d=b.join(""),e=$.inArray(d,c);e!=-1&&c.splice(e,1);c.push(d)});c.push("");a.element.val(c.join(a.separator))}else try{e=
function(){};try{e=window.eval("window."+a.selectedModel)}catch(h){if(SL.debugEnable)throw h;}return e(a.element,f)}catch(i){throw SL.debugEnable&&SL.debug("\u81ea\u5b9a\u4e49\u9009\u62e9\u51fd\u6570"+a.selectedModel+"\u6267\u884c\u5f02\u5e38:"+i),i;}}}}else SL.debugEnable&&SL.debug("\u6570\u636e\u9009\u62e9\u6765\u6e90\u7ec4\u4ef6\u4e0d\u652f\u6301");else SL.debugEnable&&SL.debug("\u6570\u636e\u9009\u62e9\u6765\u6e90\u7ec4\u4ef6\u4e0d\u5b58\u5728")},h={autoOpen:!1,modal:!0,buttons:[{text:"\u786e\u5b9a",
click:function(){c()!==!1&&$(this).dialog("close")}},{text:"\u53d6\u6d88",click:function(){$(this).dialog("close")}}]};$.extend(h,b.options);b.element.dialog(h);b.button.bind(b.dialogOn,function(){b.element.dialog("open");b.cascadeTo&&$("#"+b.cascadeTo).trigger("cascadeInited")})};slradBigSelector.prototype.initData=function(){};
$(document).ready(function(){$(document).data("slrad_bigselector")||($(document).data("slrad_bigselector",!0),SL.loadJQueryUI(function(){$(".BigSelector").each(function(){var a=$(this);(new slradBigSelector(a)).initData()});$(document).trigger("slrad_bigselector_ready")}))});
